<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Woodytoys Wiki</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        
        <meta name="description" content="Woodytoys documentation">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "ayu" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="index.html">Introduction</a></li><li class="chapter-item expanded "><a href="setting-up/index.html"><strong aria-hidden="true">1.</strong> Setting up</a></li><li class="chapter-item expanded "><a href="analysis/index.html"><strong aria-hidden="true">2.</strong> Analysis</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="analysis/cloud.html"><strong aria-hidden="true">2.1.</strong> Cloud</a></li><li class="chapter-item expanded "><a href="analysis/dns.html"><strong aria-hidden="true">2.2.</strong> DNS</a></li><li class="chapter-item expanded "><a href="analysis/web.html"><strong aria-hidden="true">2.3.</strong> Web</a></li><li class="chapter-item expanded "><a href="analysis/mail.html"><strong aria-hidden="true">2.4.</strong> Mail</a></li></ol></li><li class="chapter-item expanded "><a href="infrastructure/index.html"><strong aria-hidden="true">3.</strong> Infrastructure and data</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="infrastructure/wiki.html"><strong aria-hidden="true">3.1.</strong> This wiki</a></li><li class="chapter-item expanded "><a href="infrastructure/git.html"><strong aria-hidden="true">3.2.</strong> The git repository</a></li><li class="chapter-item expanded "><a href="infrastructure/ci.html"><strong aria-hidden="true">3.3.</strong> Continous Integration</a></li></ol></li><li class="chapter-item expanded "><a href="deployment/index.html"><strong aria-hidden="true">4.</strong> Deployment</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="deployment/networking.html"><strong aria-hidden="true">4.1.</strong> Networking</a></li><li class="chapter-item expanded "><a href="deployment/portainer.html"><strong aria-hidden="true">4.2.</strong> Portainer</a></li><li class="chapter-item expanded "><a href="deployment/intra/index.html"><strong aria-hidden="true">4.3.</strong> The intranet</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="deployment/intra/www.html"><strong aria-hidden="true">4.3.1.</strong> Showroom website</a></li><li class="chapter-item expanded "><a href="deployment/intra/b2b.html"><strong aria-hidden="true">4.3.2.</strong> B2B website</a></li><li class="chapter-item expanded "><a href="deployment/intra/erp.html"><strong aria-hidden="true">4.3.3.</strong> Administration website</a></li><li class="chapter-item expanded "><a href="deployment/intra/wiki.html"><strong aria-hidden="true">4.3.4.</strong> Wiki website</a></li><li class="chapter-item expanded "><a href="deployment/intra/dns.html"><strong aria-hidden="true">4.3.5.</strong> DNS server</a></li><li class="chapter-item expanded "><a href="deployment/intra/db.html"><strong aria-hidden="true">4.3.6.</strong> Database</a></li><li class="chapter-item expanded "><a href="deployment/intra/mail.html"><strong aria-hidden="true">4.3.7.</strong> Mail server</a></li><li class="chapter-item expanded "><a href="deployment/intra/wiki.html"><strong aria-hidden="true">4.3.8.</strong> Documentation website</a></li></ol></li><li class="chapter-item expanded "><a href="deployment/swarm.html"><strong aria-hidden="true">4.4.</strong> Docker Swarm</a></li></ol></li><li class="chapter-item expanded "><a href="maintenace/index.html"><strong aria-hidden="true">5.</strong> Maintenance</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="maintenance/healthchecks.html"><strong aria-hidden="true">5.1.</strong> Health checks</a></li><li class="chapter-item expanded "><a href="maintenance/users.html"><strong aria-hidden="true">5.2.</strong> Managing users</a></li><li class="chapter-item expanded "><a href="maintenance/service-update.html"><strong aria-hidden="true">5.3.</strong> Updating services</a></li><li class="chapter-item expanded "><a href="maintenance/system-update.html"><strong aria-hidden="true">5.4.</strong> Updating the system</a></li><li class="chapter-item expanded "><a href="maintenance/troobleshootin.html"><strong aria-hidden="true">5.5.</strong> Troobleshooting</a></li></ol></li><li class="chapter-item expanded "><a href="TODOS.html"><strong aria-hidden="true">6.</strong> TODOS.md</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Woodytoys Wiki</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/austreelis//2tm1-admin-sys2" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <blockquote>
<p>This project was created for a second-year system administration course at
<a href="ephec.be">Ephec</a>.</p>
<div class="table-wrapper"><table><thead><tr><th>Group</th><th>Students</th></tr></thead><tbody>
<tr><td>M1-04</td><td>Habibou Moulaye, Morgane Leclerc, Nicolas ???</td></tr>
</tbody></table>
</div>
<p>The scope of the project was the simulation of the administration of a
company network infrastructure, at a high level, within a set of docker
containers. This wiki reflects this, in that nothing beyond what was actually
set up within the docker bubble is documented.</p>
</blockquote>
<h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p>This wiki is the documentation written for the team of <strong>Woodytoys</strong>.</p>
<blockquote>
<p>⚠️ This wiki still largely is incomplete. Notably, some pages reference empty
pages.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="setting-up"><a class="header" href="#setting-up">Setting up</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="analysis"><a class="header" href="#analysis">Analysis</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="cloud"><a class="header" href="#cloud">Cloud</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="dns"><a class="header" href="#dns">DNS</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="web"><a class="header" href="#web">Web</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="mail"><a class="header" href="#mail">Mail</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="infrastructure-and-data"><a class="header" href="#infrastructure-and-data">Infrastructure and data</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="this-wiki"><a class="header" href="#this-wiki">This wiki</a></h1>
<p>This wiki is powered by <a href="https://rust-lang.github.io/mdBook/">mdBook</a>, an
open-source static site generator from Markdown by the
<a href="https://www.rust-lang.org/">Rust project</a>.</p>
<h2 id="depployments"><a class="header" href="#depployments">Depployments</a></h2>
<p>This wiki is rebuilt and deployed on each push to the <code>main</code> branch of the
github repository. It can be read on github pages
<a href="https://austreelis.github.io/2tm1-admin-sys2">here</a>.</p>
<p>It is also deployed on woodytoys' intranet, through the
<a href="infrastructure/../deployment/intra/wiki.html">documentation website service</a>, and is accessible
at <code>wiki.woodytoys.home</code>.</p>
<h2 id="adding-a-page"><a class="header" href="#adding-a-page">Adding a page</a></h2>
<ol>
<li><strong>Creating the page's file:</strong>
Create the directories of all the required parent sections, if necessary. For
instance, to add a new page about foxes in a new subsections &quot;animals&quot; of the
new section &quot;creatures&quot;, recursively create the directory <code>creatures/animals</code>
under the <code>src</code> directory at the root of this book (which is where the
<code>book.toml</code> is). Then create an appropriately named markdown file, e.g.
<code>fox.md</code>, in the directory (e.g. <code>creatures/animals/fox.md</code>).</li>
<li><strong>Adding an entry in the summary:</strong>
Add a properly indented line to the file <code>src/SUMMARY.md</code>, which renders the
side menu. Also add any missing parent section or subsection, with a link
to a <code>README.md</code> in the (sub)section's directory, even if it doesn't exist.
It should be enough to just insert it in the current main list of
sections and pages, but should you want to you are not limited to it.
See mdBook's <a href="https://rust-lang.github.io/mdBook/format/index.html"><code>SUMMARY.md</code>'s documentation</a> for the different
ways to format this menu.</li>
</ol>
<p>You're now ready to write your page !</p>
<h2 id="writing-a-page"><a class="header" href="#writing-a-page">Writing a page</a></h2>
<p>The syntax of mdBooks adhere to the <a href="https://commonmark.org/">CommonMark</a>
standard, with some book-oriented extensions and rust-specific integrations
(the latter being irrelevant for us):</p>
<h3 id="text-and-paragraphs"><a class="header" href="#text-and-paragraphs">Text and Paragraphs</a></h3>
<p>Text is rendered relatively predictably: </p>
<pre><code class="language-markdown">Here is a line of text.

This is a new line.
</code></pre>
<p>Will look like you might expect:</p>
<p>Here is a line of text.</p>
<p>This is a new line.</p>
<h3 id="headings"><a class="header" href="#headings">Headings</a></h3>
<p>Headings use the <code>#</code> marker and should be on a line by themselves. More <code>#</code> mean smaller headings:</p>
<pre><code class="language-markdown">#### A heading 

Some text.

##### A smaller heading 

More text.
</code></pre>
<h4 id="a-heading"><a class="header" href="#a-heading">A heading</a></h4>
<p>Some text.</p>
<h5 id="a-smaller-heading"><a class="header" href="#a-smaller-heading">A smaller heading</a></h5>
<p>More text.</p>
<h3 id="lists"><a class="header" href="#lists">Lists</a></h3>
<p>Lists can be unordered or ordered. Ordered lists will order automatically:</p>
<pre><code class="language-markdown">* milk
* eggs
* butter

1. carrots
1. celery
1. radishes
</code></pre>
<ul>
<li>milk</li>
<li>eggs</li>
<li>butter</li>
</ul>
<ol>
<li>carrots</li>
<li>celery</li>
<li>radishes</li>
</ol>
<h3 id="links"><a class="header" href="#links">Links</a></h3>
<p>Linking to a URL or local file is easy:</p>
<pre><code class="language-markdown">Use [mdBook](https://github.com/rust-lang/mdBook). 

Read about [mdBook](mdBook.md).

A bare url: &lt;https://www.rust-lang.org&gt;.
</code></pre>
<p>Use <a href="https://github.com/rust-lang/mdBook">mdBook</a>. </p>
<p>Read about <a href="infrastructure/mdBook.html">mdBook</a>.</p>
<p>A bare url: <a href="https://www.rust-lang.org">https://www.rust-lang.org</a>.</p>
<hr />
<p>Relative links that end with <code>.md</code> will be converted to the <code>.html</code> extension.
It is recommended to use <code>.md</code> links when possible.
This is useful when viewing the Markdown file outside of mdBook, for example on GitHub or GitLab which render Markdown automatically.</p>
<p>Links to <code>README.md</code> will be converted to <code>index.html</code>.
This is done since some services like GitHub render README files automatically, but web servers typically expect the root file to be called <code>index.html</code>.</p>
<p>You can link to individual headings with <code>#</code> fragments.
For example, <code>mdbook.md#text-and-paragraphs</code> would link to the <a href="infrastructure/wiki.html#text-and-paragraphs">Text and Paragraphs</a> section above.
The ID is created by transforming the heading such as converting to lowercase and replacing spaces with dashes.
You can click on any heading and look at the URL in your browser to see what the fragment looks like.</p>
<h3 id="images"><a class="header" href="#images">Images</a></h3>
<p>Including images is simply a matter of including a link to them, much like in the <em>Links</em> section above. The following markdown
includes the Rust logo SVG image found in the <code>images</code> directory at the same level as this file:</p>
<pre><code class="language-markdown">![The Rust Logo](images/rust-logo-blk.svg)
</code></pre>
<p>Produces the following HTML when built with mdBook:</p>
<pre><code class="language-html">&lt;p&gt;&lt;img src=&quot;images/rust-logo-blk.svg&quot; alt=&quot;The Rust Logo&quot; /&gt;&lt;/p&gt;
</code></pre>
<p>Which, of course displays the image like so:</p>
<p><img src="infrastructure/images/rust-logo-blk.svg" alt="The Rust Logo" /></p>
<h3 id="extensions"><a class="header" href="#extensions">Extensions</a></h3>
<p>mdBook has several extensions beyond the standard CommonMark specification.</p>
<h4 id="strikethrough"><a class="header" href="#strikethrough">Strikethrough</a></h4>
<p>Text may be rendered with a horizontal line through the center by wrapping the
text with two tilde characters on each side:</p>
<pre><code class="language-text">An example of ~~strikethrough text~~.
</code></pre>
<p>This example will render as:</p>
<blockquote>
<p>An example of <del>strikethrough text</del>.</p>
</blockquote>
<p>This follows the <a href="https://github.github.com/gfm/#strikethrough-extension-">GitHub Strikethrough extension</a>.</p>
<h4 id="footnotes"><a class="header" href="#footnotes">Footnotes</a></h4>
<p>A footnote generates a small numbered link in the text which when clicked
takes the reader to the footnote text at the bottom of the item. The footnote
label is written similarly to a link reference with a caret at the front. The
footnote text is written like a link reference definition, with the text
following the label. Example:</p>
<pre><code class="language-text">This is an example of a footnote[^note].

[^note]: This text is the contents of the footnote, which will be rendered
    towards the bottom.
</code></pre>
<p>This example will render as:</p>
<blockquote>
<p>This is an example of a footnote<sup class="footnote-reference"><a href="#note">1</a></sup>.</p>
<div class="footnote-definition" id="note"><sup class="footnote-definition-label">1</sup>
<p>This text is the contents of the footnote, which will be rendered
towards the bottom.</p>
</div>
</blockquote>
<p>The footnotes are automatically numbered based on the order the footnotes are
written.</p>
<h4 id="tables"><a class="header" href="#tables">Tables</a></h4>
<p>Tables can be written using pipes and dashes to draw the rows and columns of
the table. These will be translated to HTML table matching the shape. Example:</p>
<pre><code class="language-text">| Header1 | Header2 |
|---------|---------|
| abc     | def     |
</code></pre>
<p>This example will render similarly to this:</p>
<div class="table-wrapper"><table><thead><tr><th>Header1</th><th>Header2</th></tr></thead><tbody>
<tr><td>abc</td><td>def</td></tr>
</tbody></table>
</div>
<p>See the specification for the <a href="https://github.github.com/gfm/#tables-extension-">GitHub Tables extension</a> for more
details on the exact syntax supported.</p>
<h4 id="task-lists"><a class="header" href="#task-lists">Task lists</a></h4>
<p>Task lists can be used as a checklist of items that have been completed.
Example:</p>
<pre><code class="language-md">- [x] Complete task
- [ ] Incomplete task
</code></pre>
<p>This will render as:</p>
<blockquote>
<ul>
<li><input disabled="" type="checkbox" checked=""/>
Complete task</li>
<li><input disabled="" type="checkbox"/>
Incomplete task</li>
</ul>
</blockquote>
<p>See the specification for the <a href="https://github.github.com/gfm/#task-list-items-extension-">task list extension</a> for more details.</p>
<h4 id="smart-punctuation"><a class="header" href="#smart-punctuation">Smart punctuation</a></h4>
<p>Some ASCII punctuation sequences will be automatically turned into fancy Unicode
characters:</p>
<div class="table-wrapper"><table><thead><tr><th>ASCII sequence</th><th>Unicode</th></tr></thead><tbody>
<tr><td><code>--</code></td><td>–</td></tr>
<tr><td><code>---</code></td><td>—</td></tr>
<tr><td><code>...</code></td><td>…</td></tr>
<tr><td><code>&quot;</code></td><td>“ or ”, depending on context</td></tr>
<tr><td><code>'</code></td><td>‘ or ’, depending on context</td></tr>
</tbody></table>
</div>
<p>So, no need to manually enter those Unicode characters!</p>
<h4 id="mathjax-support"><a class="header" href="#mathjax-support">MathJax Support</a></h4>
<p>mdBook has support for math equations through
<a href="https://www.mathjax.org/">MathJax</a>.</p>
<blockquote>
<p><strong>Note:</strong> The usual delimiters MathJax uses are not yet supported. You can't
currently use <code>$$ ... $$</code> as delimiters and the <code>\[ ... \]</code> delimiters need an
extra backslash to work. Hopefully this limitation will be lifted soon.</p>
</blockquote>
<blockquote>
<p><strong>Note:</strong> When you use double backslashes in MathJax blocks (for example in
commands such as <code>\begin{cases} \frac 1 2 \\ \frac 3 4 \end{cases}</code>) you need
to add <em>two extra</em> backslashes (e.g., <code>\begin{cases} \frac 1 2 \\\\ \frac 3 4 \end{cases}</code>).</p>
</blockquote>
<blockquote>
<p><strong>Note:</strong> As MathJax renders equations black on transparent, they tend to not
be easy to read with dark themes.</p>
</blockquote>
<h5 id="inline-equations"><a class="header" href="#inline-equations">Inline equations</a></h5>
<p>Inline equations are delimited by <code>\\(</code> and <code>\\)</code>. So for example, to render the
following inline equation \( \int x dx = \frac{x^2}{2} + C \) you would write
the following:</p>
<pre><code>\\( \int x dx = \frac{x^2}{2} + C \\)
</code></pre>
<h5 id="block-equations"><a class="header" href="#block-equations">Block equations</a></h5>
<p>Block equations are delimited by <code>\\[</code> and <code>\\]</code>. To render the following
equation</p>
<p>\[ \mu = \frac{1}{N} \sum_{i=0} x_i \]</p>
<p>you would write:</p>
<pre><code class="language-bash">\\[ \mu = \frac{1}{N} \sum_{i=0} x_i \\]
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="the-git-repository"><a class="header" href="#the-git-repository">The git repository</a></h1>
<p>A remote git repository is hosted at <a href="https://github.com/austreelis/2t-admin-sys2">Github</a>.</p>
<h2 id="branches-and-history"><a class="header" href="#branches-and-history">Branches and history</a></h2>
<p>There are two permanent branches:</p>
<ul>
<li><code>main</code>: The main development branch. Quick fixes and uncontroversial changes
can be pushed on it directly. It is however protected against forced pushes
and requires a linear history (even when merging pull requests).</li>
<li><code>gh-pages</code>: The branch used to deploy to github pages. This branch should
never be pushed to, as this will break the latest wiki deployment on there.
See <a href="infrastructure/./ci.html">continuous integration</a> for more informations.</li>
</ul>
<p>Any change too big or potentially controversial should be pushed to a fork (or
another branch, for maintainers having write access) and a pull request opened.
Once the PR is merged, all the changes will be squashed and rebased on top of
<code>main</code> (if there is no conflicts).</p>
<h2 id="files-d-irectories"><a class="header" href="#files-d-irectories">Files &amp;d irectories</a></h2>
<h3 id="files-in-the-root"><a class="header" href="#files-in-the-root">Files in the root</a></h3>
<p>A series of configuration or utility files are placed at the root of the repo:</p>
<ul>
<li><code>README.md</code>: A file consicely presenting the project.</li>
<li><code>LICENSE</code>: The license the files in this repository are distributed under,
along with the copyright notice.</li>
<li><code>.gitignore</code>: Git's <a href="https://git-scm.com/docs/gitignore">ignore file</a>.</li>
<li><code>docker-setup.sh</code>: A script to correctly setup a layer-3 ipvlan docker
network without having to remember or google the command.</li>
<li><code>flake.nix</code> (&amp; <code>flake.lock</code>): A configuration file declaring a
<a href="infrastructure/nixos.org">nix</a> <a href="https://nixos.wiki/wiki/Flakes">flake</a>. See also
<a href="infrastructure/../setting-up/nix.html">setting up with nix</a>.</li>
</ul>
<h3 id="woodytoys"><a class="header" href="#woodytoys"><code>woodytoys/</code></a></h3>
<p>The root directory of the deployment configuration (see
<a href="infrastructure/../deployment/README.html">deployment</a>). This folder contains:</p>
<ul>
<li><code>images</code>: A folder in which each directory contains a <code>Dockerfile</code> and the
files required to build a custom image, e.g. this wiki's image <code>mdbook</code>.</li>
<li><code>services</code>: A folder in which each directory contains configuration file for
the deployed services, e.g. the php scripts for the <code>b2b</code> service.</li>
<li><code>stacks</code>: A folder containing a series of Docker compose files describing
groups of services to deploy.</li>
<li><code>docker-compose.yml</code>: A Docker compose file declaring the services needed to
run portainer. See also <a href="infrastructure/../deployment/portainer.html">portainer</a></li>
</ul>
<h3 id="wiki"><a class="header" href="#wiki"><code>wiki/</code></a></h3>
<p>The source files for this wiki. See also <a href="infrastructure/./wiki.html">this wiki</a>.</p>
<p>This folder actually is a symbolic link to <code>woodytoys/images/mdbook/book</code>,
because the image builds the book and thus needs the source in its context
directory (in the Docker sense).</p>
<h3 id="snippet"><a class="header" href="#snippet"><code>snippet/</code></a></h3>
<p>A directory gathering tests, drafts and snippets from early stages in the
project. Likely to get nuked, soon™.</p>
<h3 id="github"><a class="header" href="#github"><code>.github/</code></a></h3>
<p>Github-specific configuration. Notably, we use it to declare jobs to run
automatically on certain events. See also <a href="infrastructure/./ci.html">continuous integration</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="continous-integration"><a class="header" href="#continous-integration">Continous Integration</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="deployment"><a class="header" href="#deployment">Deployment</a></h1>
<p>This section walks you through the deployment process of woodytoys' stack.</p>
<h2 id="prerequities"><a class="header" href="#prerequities">Prerequities</a></h2>
<h3 id="general-setup"><a class="header" href="#general-setup">General setup</a></h3>
<p>You should have the basic tools installed and the repository cloned on the
deployed host, as outlined in the <a href="deployment/../setting-up/README.html">Setting up</a>
section.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="networking"><a class="header" href="#networking">Networking</a></h1>
<blockquote>
<p>Note: All these steps may be done in Portainer, but you may encounter some
issues (especially with swarm) reserving the expected address spaces.</p>
</blockquote>
<h2 id="layer-3-ipvlan"><a class="header" href="#layer-3-ipvlan">Layer-3 IPVLAN</a></h2>
<p>The containers communicate through a layer-3 ipvlan docker network. However
Portainer cannot create it when creating a stack from a compose file.</p>
<p>The compose files in <code>woodytoys/stacks</code> assume a network named
<code>woodytoys-&lt;stack&gt;-l3ipvlan</code> is created beforehand, with a series of subnets.</p>
<p>For instance, the <code>intra</code> and <code>client</code> stacks expect <code>woodytoys-intra-l3ipvlan</code>
to be created using this command:</p>
<pre><code class="language-bash">docker network create \
  -d ipvlan \
  -o parent=&lt;outer-interface&gt; \
  -o ipvlan_mode=l3 \
  --subnet 10.0.0.0/24 \
  --subnet 10.0.1.0/24 \
  --subnet 10.0.2.0/24 \
  --subnet 10.0.3.0/24 \
  --subnet 10.0.4.0/24 \
  --subnet 10.0.5.0/24 \
  --subnet 10.0.6.0/24 \
  --subnet 10.0.7.0/24 \
  woodytoys-intra-l3ipvlan
</code></pre>
<blockquote>
<p>A script to correctly setup l3-ipvlan networks is available at
<code>woodytoys/setup-vlans.sh</code>.</p>
</blockquote>
<blockquote>
<p>Note: if using Docker Swarm, you will need to override the default scope
(<code>local</code>) with <code>--scope swarm</code>.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="portainer"><a class="header" href="#portainer">Portainer</a></h1>
<p>This project uses Portainer to manage anything Docker-related. It doesn't
remove the ability to manage Docker solely from the command line or by editing
the compose files, but rather offers a graphical interface on top of the Docker
Daemon.</p>
<h2 id="installing-the-portainer-server"><a class="header" href="#installing-the-portainer-server">Installing the Portainer server.</a></h2>
<p>On the host, simply run:</p>
<pre><code class="language-bash">docker-compose --project-directory woodytoys -p portainer up -d
</code></pre>
<p>Then connect to the host on port <code>50001</code>. You should see Portainer's first
launch page, which asks for the creation of an account.</p>
<blockquote>
<p>This documentation will assume the user and its password are <code>woodytoys</code> &amp;
<code>five-nights-at-freddies</code>, but you can and should choose better credentials
🙂.</p>
</blockquote>
<p>Once logged in, you should land on the home page. You should not need to add an
environment for now, so click &quot;get started&quot;. Then choose the <code>local</code>
environment, that is the Docker daemon Portainer is running on.</p>
<p>You should then be able to see the created stacks: there should only be one,
called &quot;portainer&quot;, with &quot;limited&quot; control. This is representing the compose
file declaring the service running for the Portainer server.</p>
<p>Other woodytoys services will be in their own stacks.</p>
<p>If you didn't create layer-3 vlans before, you may now through Portainer's
interface.</p>
<h2 id="portainers-container-config"><a class="header" href="#portainers-container-config">Portainer's container config</a></h2>
<blockquote>
<p>TODO: Explain networks and volumes of the compose file</p>
</blockquote>
<h2 id="portainers-env-and-stack-setups"><a class="header" href="#portainers-env-and-stack-setups">Portainer's env and stack setups</a></h2>
<blockquote>
<p>TODO: Explain how we assume stacks and environments are setup</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="the-intranet"><a class="header" href="#the-intranet">The intranet</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="showroom-website"><a class="header" href="#showroom-website">Showroom website</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="b2b-website"><a class="header" href="#b2b-website">B2B website</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="administration-website"><a class="header" href="#administration-website">Administration website</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="documentation-website"><a class="header" href="#documentation-website">Documentation website</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="dns-server"><a class="header" href="#dns-server">DNS server</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="database"><a class="header" href="#database">Database</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="mail-server"><a class="header" href="#mail-server">Mail server</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="documentation-website-1"><a class="header" href="#documentation-website-1">Documentation website</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="docker-swarm"><a class="header" href="#docker-swarm">Docker Swarm</a></h1>
<p>Although it wasn't extensively tested, deploying with Docker Swarm should be
straightforward.</p>
<h3 id="why-use-swarm-"><a class="header" href="#why-use-swarm-">Why use Swarm ?</a></h3>
<p>The benefits of deploying using Docker Swarm mainly are the following:</p>
<h4 id="using-the-portainer-agent"><a class="header" href="#using-the-portainer-agent">Using the Portainer Agent</a></h4>
<p>A Portainer Agent installed on the host allows managing several hosts from a
single Portainer server. Even without Swarm, it would be the easiest solution
to manage two separate hosts running Woodytoys' containers (instead of having
two different Portainer servers).</p>
<p>The &quot;default&quot; setup outlined in this documentation runs a Portainer server
on the host, alongside all other containers. It directly talks to the host's
Docker daemon. While it's possible to use the Portainer Agent with this setup
already, we did not set this up. However, it's considered bad practice not to
when using Swarm (and practically a lot harder to manage).</p>
<p>So while the Portainer Agent could come useful without Swarm, it's not really
worth the work to setup just yet, but could bring more value than just enabling
Swarm.</p>
<h4 id="better-scalability"><a class="header" href="#better-scalability">Better scalability</a></h4>
<p>Swarm allows to easily replicate services and run them accross several
hosts (nodes, in Swarm jargon). While this needs some more work than what's
currently setup, it should only require some adjustment to the routing and
DNS infrastructure.</p>
<h3 id="deploying-with-docker-swarm"><a class="header" href="#deploying-with-docker-swarm">Deploying with Docker Swarm</a></h3>
<p>To deploy Woodytoys' stack with Swarm, you should first choose a host, or node,
that will act as a &quot;manager&quot; for the swarm. All nodes may be manager, but you
may want some nodes to only be able to run services without managing others.</p>
<blockquote>
<p>For instance, with enough nodes, it's common to have some dedicated to
&quot;public-facing&quot; services so that comprimising one of them doesn't necessarily
gives managing rights on the Swarm.</p>
</blockquote>
<p>On the &quot;initial&quot; manager node, create a new swarm. You may want to look at the
options first:</p>
<pre><code class="language-bash">docker swarm init --help
# Then actually create one, adding options you see fit
docker swarm init --advertise-addr ens33 --listen-addr ens33
</code></pre>
<p>Then run the portainer agent:</p>
<pre><code class="language-bash">docker run -d \
  -p 9001:9001 \
  --restart always \
  --name portainer_agent \
  -v /var/run/docker.sock:/var/run/docker.sock \
  -v /var/lib/docker/volumes:/var/lib/docker/volumes \
  portainer/agent:latest
</code></pre>
<p>Before continuing to setup Portainer in the next section. You may run the
server on this host, or any other, as long as it can reach its port <code>9001</code>.</p>
<p>See also <a href="https://docs.portainer.io/admin/environments/add/docker/agent">Portainer's</a> and <a href="https://docs.docker.com/engine/swarm/">Docker's</a>
documentation.</p>
<h3 id="adding-a-node-to-the-swarm"><a class="header" href="#adding-a-node-to-the-swarm">Adding a node to the Swarm</a></h3>
<p>To add a node, you will need to generate a &quot;worker&quot; or &quot;manager&quot; token
(depending on which kind of node you want to add), from any existing manager
node:</p>
<pre><code class="language-bash">docker swarm join-token worker
# Or manager instead of worker
</code></pre>
<p>Copy or transfer the token somehow, then on the new node:</p>
<pre><code class="language-bash">docker swarm join --token &lt;the-token-from-previous-step&gt; &lt;manager-ip&gt;:&lt;port&gt;
</code></pre>
<p>Finally, run the portainer agent:</p>
<pre><code class="language-bash">docker run -d \
  -p 9001:9001 \
  --restart always \
  --name portainer_agent \
  -v /var/run/docker.sock:/var/run/docker.sock \
  -v /var/lib/docker/volumes:/var/lib/docker/volumes \
  portainer/agent:latest
</code></pre>
<p>You should be able to deploy services to this node from your Portainer server.</p>
<p>See also <a href="https://docs.portainer.io/admin/environments/add/docker/agent">Portainer's</a> and <a href="https://docs.docker.com/engine/swarm/">Docker's</a>
documentation.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="maintenance"><a class="header" href="#maintenance">Maintenance</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="service-health-checks"><a class="header" href="#service-health-checks">Service health checks</a></h1>
<p>Most of the service are monitored on a coarse level through
<a href="https://docs.docker.com/engine/reference/builder/#healthcheck">Docker healthchecks</a>.</p>
<h2 id="interpreting-health-status"><a class="header" href="#interpreting-health-status">Interpreting health status</a></h2>
<p>Upon starting, a container is in the <code>starting</code> state. This means no
healthcheck has been successful yet, but it's still early enough that those
failures do not count toward the maximum amount of failure.</p>
<p>Whenever a healtcheck succeeds, a container becomes <code>healty</code>.</p>
<p>If more than a given maximum of healtcheck retries fail, the container becomes
<code>unhealthy</code>.</p>
<h2 id="how-to-write-healthchecks"><a class="header" href="#how-to-write-healthchecks">How to write healthchecks</a></h2>
<p>Healthchecks are scripts or command that exit with code either <code>0</code> or <code>1</code>
(no other exit code should be used !), and are run in the container's shell.</p>
<p>This means the container's image needs to include all the dependencies needed
to execute the healthcheck, and it must have a shell ! (For instance, the
portainer image we use doesn't).</p>
<p>Alternatively, it may directly execute an executable, but that's often
impractical.</p>
<blockquote>
<p><strong>Tip:</strong>: an easy way with bash to make any failing command eit with code 1
instead of any non-zero code is <code>command that fails || exit 1</code>.</p>
</blockquote>
<p>Ideally, healthchecks should not rely on any other service to be running,
except when service have explicit dependencies (which should be indicated in
the compose file).</p>
<p>Most services use a timeout of 10s, meaning healthchecks running longer than
that will be considered failed even if they succeed later.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="managing-users"><a class="header" href="#managing-users">Managing users</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="updating-services"><a class="header" href="#updating-services">Updating services</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="updating-the-system"><a class="header" href="#updating-the-system">Updating the system</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="troobleshooting"><a class="header" href="#troobleshooting">Troobleshooting</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="todosmd"><a class="header" href="#todosmd">TODOS.md</a></h1>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            MathJax.Hub.Register.StartupHook('End', function() {
                window.setTimeout(window.print, 100);
            });
        });
        </script>

    </div>
    </body>
</html>
